<?php
/**
 * MyShop - MSSQL Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ ÌéòÏù¥ÏßÄ
 * ÌååÏùºÎ™Ö: mssql_conn_test.php
 * ÏúÑÏπò: src/
 */

// ÏóêÎü¨ ÌëúÏãú ÌôúÏÑ±Ìôî
error_reporting(E_ALL);
ini_set('display_errors', 1);

// ÌéòÏù¥ÏßÄ ÏãúÏûë ÏãúÍ∞Ñ
$start_time = microtime(true);

// config/database.php ÌååÏùº Î°úÎìú ÏãúÎèÑ (Ïó∞Í≤∞ ÌÖåÏä§Ìä∏Î•º ÏúÑÌï¥ Ï£ºÏÑù Ï≤òÎ¶¨)
$config_loaded = false;
$config_path = '';
$connection_error = null;
$connection_success = false;

// Í∞ÄÎä•Ìïú Í≤ΩÎ°úÎì§ ÏãúÎèÑ
$possible_paths = [
    __DIR__ . '/config/database.php',
    __DIR__ . '/../config/database.php',
    dirname(__DIR__) . '/config/database.php'
];

// ÏÑ§Ï†ï ÌååÏùºÏóêÏÑú Î≥ÄÏàò Ï∂îÏ∂ú
$db_server = null;
$db_port = null;
$db_database = null;
$db_username = null;
$db_password = null;
$db_charset = null;

foreach ($possible_paths as $path) {
    if (file_exists($path)) {
        // ÌååÏùº ÎÇ¥Ïö© ÏùΩÍ∏∞ (Ïó∞Í≤∞ÌïòÏßÄ ÏïäÍ≥†)
        $file_content = file_get_contents($path);
        
        // ÏÑ§Ï†ïÍ∞í Ï∂îÏ∂ú
        if (preg_match("/define\('DB_SERVER',\s*'([^']+)'\)/", $file_content, $matches)) {
            $db_server = $matches[1];
        }
        if (preg_match("/define\('DB_PORT',\s*'([^']+)'\)/", $file_content, $matches)) {
            $db_port = $matches[1];
        }
        if (preg_match("/define\('DB_DATABASE',\s*'([^']+)'\)/", $file_content, $matches)) {
            $db_database = $matches[1];
        }
        if (preg_match("/define\('DB_USERNAME',\s*'([^']+)'\)/", $file_content, $matches)) {
            $db_username = $matches[1];
        }
        if (preg_match("/define\('DB_PASSWORD',\s*'([^']+)'\)/", $file_content, $matches)) {
            $db_password = $matches[1];
        }
        if (preg_match("/define\('DB_CHARSET',\s*'([^']+)'\)/", $file_content, $matches)) {
            $db_charset = $matches[1];
        }
        
        $config_loaded = true;
        $config_path = $path;
        break;
    }
}

?>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSSQL Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ - MyShop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .test-header {
            background: #f5f5f5;
            padding: 15px 20px;
            font-weight: bold;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
        }
        
        .test-body {
            padding: 20px;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .info-table th,
        .info-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .info-table th {
            background: #f8f9fa;
            font-weight: bold;
            width: 220px;
        }
        
        .info-table tr:last-child th,
        .info-table tr:last-child td {
            border-bottom: none;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            line-height: 1.6;
        }
        
        .alert.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .alert.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .button {
            display: inline-block;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .button:hover {
            background: #5568d3;
        }
        
        .button.danger {
            background: #dc3545;
        }
        
        .button.danger:hover {
            background: #c82333;
        }
        
        .error-detail {
            background: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .success-icon {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
        }
        
        ul {
            margin-left: 20px;
            line-height: 1.8;
        }
        
        .footer-note {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-top: 2px solid #e0e0e0;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç MSSQL Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</h1>
            <p>MyShop Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞ ÏßÑÎã® ÎèÑÍµ¨ (SQLSRV)</p>
        </div>
        
        <div class="content">
            <!-- PHP ÌôòÍ≤Ω Ï≤¥ÌÅ¨ -->
            <div class="test-section">
                <div class="test-header">
                    <span>1Ô∏è‚É£ PHP ÌôòÍ≤Ω Ï≤¥ÌÅ¨</span>
                </div>
                <div class="test-body">
                    <table class="info-table">
                        <tr>
                            <th>PHP Î≤ÑÏ†Ñ</th>
                            <td>
                                <?php 
                                echo phpversion(); 
                                $php_ok = version_compare(PHP_VERSION, '7.4.0', '>=');
                                ?>
                                <?php if ($php_ok): ?>
                                    <span class="status success">‚úì Í∂åÏû•</span>
                                <?php else: ?>
                                    <span class="status warning">‚ö† PHP 7.4+ Í∂åÏû•</span>
                                <?php endif; ?>
                            </td>
                        </tr>
                        <tr>
                            <th>Ïö¥ÏòÅÏ≤¥Ï†ú</th>
                            <td><?php echo PHP_OS; ?></td>
                        </tr>
                        <tr>
                            <th>ÏÑúÎ≤Ñ ÏÜåÌîÑÌä∏Ïõ®Ïñ¥</th>
                            <td><?php echo $_SERVER['SERVER_SOFTWARE'] ?? 'Unknown'; ?></td>
                        </tr>
                        <tr>
                            <th>ÌòÑÏû¨ ÏãúÍ∞Ñ</th>
                            <td><?php echo date('Y-m-d H:i:s'); ?></td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- SQLSRV ÎìúÎùºÏù¥Î≤Ñ Ï≤¥ÌÅ¨ -->
            <div class="test-section">
                <div class="test-header">
                    <span>2Ô∏è‚É£ SQLSRV ÎìúÎùºÏù¥Î≤Ñ Ï≤¥ÌÅ¨</span>
                </div>
                <div class="test-body">
                    <?php
                    $sqlsrv_loaded = extension_loaded('sqlsrv');
                    $pdo_sqlsrv_loaded = extension_loaded('pdo_sqlsrv');
                    ?>
                    
                    <table class="info-table">
                        <tr>
                            <th>SQLSRV ÌôïÏû•</th>
                            <td>
                                <span class="status <?php echo $sqlsrv_loaded ? 'success' : 'error'; ?>">
                                    <?php echo $sqlsrv_loaded ? '‚úì ÏÑ§ÏπòÎê®' : '‚úó ÎØ∏ÏÑ§Ïπò'; ?>
                                </span>
                                <?php if ($sqlsrv_loaded): ?>
                                    <span style="color: #666; font-size: 12px; margin-left: 10px;">
                                        (Î≤ÑÏ†Ñ: <?php echo phpversion('sqlsrv'); ?>)
                                    </span>
                                <?php endif; ?>
                            </td>
                        </tr>
                        <tr>
                            <th>PDO_SQLSRV ÌôïÏû•</th>
                            <td>
                                <span class="status <?php echo $pdo_sqlsrv_loaded ? 'success' : 'warning'; ?>">
                                    <?php echo $pdo_sqlsrv_loaded ? '‚úì ÏÑ§ÏπòÎê®' : '‚óã ÏÑ†ÌÉùÏÇ¨Ìï≠'; ?>
                                </span>
                                <?php if ($pdo_sqlsrv_loaded): ?>
                                    <span style="color: #666; font-size: 12px; margin-left: 10px;">
                                        (Î≤ÑÏ†Ñ: <?php echo phpversion('pdo_sqlsrv'); ?>)
                                    </span>
                                <?php endif; ?>
                            </td>
                        </tr>
                    </table>
                    
                    <?php if (!$sqlsrv_loaded): ?>
                        <div class="alert error">
                            <strong>‚ö†Ô∏è SQLSRV ÎìúÎùºÏù¥Î≤ÑÍ∞Ä ÏÑ§ÏπòÎêòÏñ¥ ÏûàÏßÄ ÏïäÏäµÎãàÎã§!</strong><br><br>
                            <strong>Ìï¥Í≤∞ Î∞©Î≤ï:</strong><br>
                            <ul>
                                <li><strong>1Îã®Í≥Ñ:</strong> Microsoft ODBC Driver 17 for SQL Server Îã§Ïö¥Î°úÎìú Î∞è ÏÑ§Ïπò
                                    <br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://learn.microsoft.com/en-us/sql/connect/odbc/download-odbc-driver-for-sql-server" target="_blank">Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨</a>
                                </li>
                                <li><strong>2Îã®Í≥Ñ:</strong> PHP SQLSRV ÌôïÏû• Îã§Ïö¥Î°úÎìú
                                    <br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://learn.microsoft.com/en-us/sql/connect/php/download-drivers-php-sql-server" target="_blank">Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨</a>
                                </li>
                                <li><strong>3Îã®Í≥Ñ:</strong> php.ini ÌååÏùºÏóê Îã§Ïùå ÎùºÏù∏ Ï∂îÍ∞Ä:
                                    <div class="code-block" style="margin-top: 10px;">extension=php_sqlsrv_<?php echo substr(PHP_VERSION, 0, 3); ?>_ts.dll
extension=php_pdo_sqlsrv_<?php echo substr(PHP_VERSION, 0, 3); ?>_ts.dll</div>
                                </li>
                                <li><strong>4Îã®Í≥Ñ:</strong> Apache/ÏõπÏÑúÎ≤Ñ Ïû¨ÏãúÏûë</li>
                            </ul>
                        </div>
                    <?php else: ?>
                        <div class="alert success">
                            ‚úì SQLSRV ÎìúÎùºÏù¥Î≤ÑÍ∞Ä Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÏÑ§ÏπòÎêòÏñ¥ ÏûàÏäµÎãàÎã§!
                        </div>
                    <?php endif; ?>
                </div>
            </div>

            <!-- Config ÌååÏùº Ï≤¥ÌÅ¨ -->
            <div class="test-section">
                <div class="test-header">
                    <span>3Ô∏è‚É£ ÏÑ§Ï†ï ÌååÏùº Ï≤¥ÌÅ¨</span>
                </div>
                <div class="test-body">
                    <?php if ($config_loaded): ?>
                        <div class="alert success">
                            ‚úì ÏÑ§Ï†ï ÌååÏùºÏùÑ Ï∞æÏïòÏäµÎãàÎã§: <br>
                            <code style="font-size: 12px;"><?php echo $config_path; ?></code>
                        </div>
                        
                        <table class="info-table">
                            <tr>
                                <th>DB_SERVER</th>
                                <td>
                                    <?php echo $db_server ? htmlspecialchars($db_server) : '<span class="status error">ÎØ∏Ï†ïÏùò</span>'; ?>
                                </td>
                            </tr>
                            <tr>
                                <th>DB_PORT</th>
                                <td>
                                    <?php echo $db_port ? htmlspecialchars($db_port) : '<span class="status warning">Í∏∞Î≥∏Í∞í(1433)</span>'; ?>
                                </td>
                            </tr>
                            <tr>
                                <th>DB_DATABASE</th>
                                <td>
                                    <?php echo $db_database ? htmlspecialchars($db_database) : '<span class="status error">ÎØ∏Ï†ïÏùò</span>'; ?>
                                </td>
                            </tr>
                            <tr>
                                <th>DB_USERNAME</th>
                                <td>
                                    <?php echo $db_username ? htmlspecialchars($db_username) : '<span class="status error">ÎØ∏Ï†ïÏùò</span>'; ?>
                                </td>
                            </tr>
                            <tr>
                                <th>DB_PASSWORD</th>
                                <td>
                                    <?php echo $db_password ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '<span class="status error">ÎØ∏Ï†ïÏùò</span>'; ?>
                                </td>
                            </tr>
                            <tr>
                                <th>DB_CHARSET</th>
                                <td>
                                    <?php echo $db_charset ? htmlspecialchars($db_charset) : '<span class="status warning">ÎØ∏Ï†ïÏùò</span>'; ?>
                                </td>
                            </tr>
                        </table>
                    <?php else: ?>
                        <div class="alert error">
                            ‚úó ÏÑ§Ï†ï ÌååÏùº(config/database.php)ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.<br><br>
                            <strong>ÏãúÎèÑÌïú Í≤ΩÎ°ú:</strong>
                            <ul>
                                <?php foreach ($possible_paths as $path): ?>
                                    <li><code><?php echo $path; ?></code></li>
                                <?php endforeach; ?>
                            </ul>
                        </div>
                    <?php endif; ?>
                </div>
            </div>

            <!-- Ïã§Ï†ú Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ -->
            <div class="test-section">
                <div class="test-header">
                    <span>4Ô∏è‚É£ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞ ÌÖåÏä§Ìä∏</span>
                </div>
                <div class="test-body">
                    <?php
                    if (!$config_loaded) {
                        echo '<div class="alert warning">‚ö†Ô∏è ÏÑ§Ï†ï ÌååÏùºÏùÑ Î®ºÏ†Ä Î°úÎìúÌï¥Ïïº Ìï©ÎãàÎã§.</div>';
                    } elseif (!$sqlsrv_loaded) {
                        echo '<div class="alert warning">‚ö†Ô∏è SQLSRV ÎìúÎùºÏù¥Î≤ÑÎ•º Î®ºÏ†Ä ÏÑ§ÏπòÌï¥Ïïº Ìï©ÎãàÎã§.</div>';
                    } else {
                        // Ïó∞Í≤∞ Ï†ïÎ≥¥ ÌëúÏãú
                        echo '<h4>üìå Ïó∞Í≤∞ Ï†ïÎ≥¥</h4>';
                        echo '<div class="code-block">';
                        echo 'Server: ' . htmlspecialchars($db_server) . '<br>';
                        echo 'Port: ' . htmlspecialchars($db_port) . '<br>';
                        echo 'Database: ' . htmlspecialchars($db_database) . '<br>';
                        echo 'Username: ' . htmlspecialchars($db_username) . '<br>';
                        echo 'CharacterSet: ' . htmlspecialchars($db_charset);
                        echo '</div>';
                        
                        // Ïó∞Í≤∞ ÏãúÎèÑ
                        $connectionInfo = array(
                            "Database" => $db_database,
                            "UID" => $db_username,
                            "PWD" => $db_password,
                            "CharacterSet" => $db_charset
                        );
                        
                        echo '<h4 style="margin-top: 20px;">üìå Ïó∞Í≤∞ ÏãúÎèÑ Ï§ë...</h4>';
                        
                        $conn = @sqlsrv_connect($db_server, $connectionInfo);
                        
                        if ($conn === false) {
                            $errors = sqlsrv_errors();
                            echo '<div class="alert error">';
                            echo '<strong>‚úó Ïó∞Í≤∞ Ïã§Ìå®</strong><br><br>';
                            
                            if ($errors) {
                                echo '<strong>ÏóêÎü¨ ÏÑ∏Î∂ÄÏÇ¨Ìï≠:</strong><br>';
                                foreach ($errors as $error) {
                                    echo '<div class="error-detail">';
                                    echo '<strong>SQLSTATE:</strong> ' . htmlspecialchars($error['SQLSTATE']) . '<br>';
                                    echo '<strong>Code:</strong> ' . htmlspecialchars($error['code']) . '<br>';
                                    echo '<strong>Message:</strong> ' . htmlspecialchars($error['message']);
                                    echo '</div>';
                                }
                            }
                            
                            echo '</div>';
                            
                            // Ìï¥Í≤∞ Î∞©Î≤ï Ï†úÏãú
                            echo '<div class="alert warning">';
                            echo '<strong>üí° Î¨∏Ï†ú Ìï¥Í≤∞ Í∞ÄÏù¥Îìú:</strong><br>';
                            echo '<ul>';
                            echo '<li><strong>ÏÑúÎ≤Ñ Ïó∞Í≤∞ Î¨∏Ï†ú:</strong> SQL ServerÍ∞Ä Ïã§Ìñâ Ï§ëÏù∏ÏßÄ ÌôïÏù∏ (192.168.1.100:1433)</li>';
                            echo '<li><strong>ÎÑ§Ìä∏ÏõåÌÅ¨ Î¨∏Ï†ú:</strong> Î∞©ÌôîÎ≤ΩÏóêÏÑú Ìè¨Ìä∏ 1433 ÌóàÏö© ÌôïÏù∏</li>';
                            echo '<li><strong>Ïù∏Ï¶ù Î¨∏Ï†ú:</strong> ÏÇ¨Ïö©Ïûê Í≥ÑÏ†ï(' . htmlspecialchars($db_username) . ')Í≥º ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏</li>';
                            echo '<li><strong>Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏóÜÏùå:</strong> \'' . htmlspecialchars($db_database) . '\' Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï°¥Ïû¨ ÌôïÏù∏</li>';
                            echo '<li><strong>SQL Server ÏÑ§Ï†ï:</strong> TCP/IP ÌîÑÎ°úÌÜ†ÏΩú ÌôúÏÑ±Ìôî ÌôïÏù∏ (SQL Server Configuration Manager)</li>';
                            echo '<li><strong>Ïù∏Ï¶ù Î™®Îìú:</strong> SQL Server Ïù∏Ï¶ù Î™®Îìú ÌôúÏÑ±Ìôî ÌôïÏù∏ (ÌòºÌï© Î™®Îìú)</li>';
                            echo '</ul>';
                            echo '</div>';
                            
                        } else {
                            $connection_success = true;
                            echo '<div class="alert success">';
                            echo '<div class="success-icon">üéâ</div>';
                            echo '<strong style="font-size: 18px;">‚úì Ïó∞Í≤∞ ÏÑ±Í≥µ!</strong><br>';
                            echo 'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§.';
                            echo '</div>';
                            
                            // ÏÑúÎ≤Ñ Ï†ïÎ≥¥ Ï°∞Ìöå
                            echo '<h4 style="margin-top: 20px;">üìä ÏÑúÎ≤Ñ Ï†ïÎ≥¥</h4>';
                            
                            $query = "SELECT 
                                        @@VERSION as version,
                                        DB_NAME() as current_db,
                                        SYSTEM_USER as system_user,
                                        GETDATE() as server_time,
                                        @@SERVERNAME as server_name";
                            
                            $stmt = sqlsrv_query($conn, $query);
                            
                            if ($stmt) {
                                $info = sqlsrv_fetch_array($stmt, SQLSRV_FETCH_ASSOC);
                                
                                echo '<table class="info-table">';
                                echo '<tr><th>ÏÑúÎ≤Ñ Ïù¥Î¶Ñ</th><td>' . htmlspecialchars($info['server_name']) . '</td></tr>';
                                echo '<tr><th>ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§</th><td>' . htmlspecialchars($info['current_db']) . '</td></tr>';
                                echo '<tr><th>ÏãúÏä§ÌÖú ÏÇ¨Ïö©Ïûê</th><td>' . htmlspecialchars($info['system_user']) . '</td></tr>';
                                echo '<tr><th>ÏÑúÎ≤Ñ ÏãúÍ∞Ñ</th><td>' . $info['server_time']->format('Y-m-d H:i:s') . '</td></tr>';
                                echo '<tr><th>SQL Server Î≤ÑÏ†Ñ</th><td style="font-size: 11px;">' . htmlspecialchars(substr($info['version'], 0, 200)) . '...</td></tr>';
                                echo '</table>';
                                
                                sqlsrv_free_stmt($stmt);
                            }
                            
                            // ÌÖåÏù¥Î∏î Î™©Î°ù Ï°∞Ìöå
                            echo '<h4 style="margin-top: 20px;">üìã Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÌÖåÏù¥Î∏î</h4>';
                            
                            $tables_query = "SELECT TABLE_NAME 
                                           FROM INFORMATION_SCHEMA.TABLES 
                                           WHERE TABLE_TYPE = 'BASE TABLE' 
                                           ORDER BY TABLE_NAME";
                            
                            $tables_stmt = sqlsrv_query($conn, $tables_query);
                            
                            if ($tables_stmt) {
                                $tables = array();
                                while ($row = sqlsrv_fetch_array($tables_stmt, SQLSRV_FETCH_ASSOC)) {
                                    $tables[] = $row['TABLE_NAME'];
                                }
                                
                                echo '<div class="code-block">';
                                if (count($tables) > 0) {
                                    echo '<strong>Ï¥ù ' . count($tables) . 'Í∞ú ÌÖåÏù¥Î∏î:</strong><br><br>';
                                    foreach ($tables as $table) {
                                        echo '‚Ä¢ ' . htmlspecialchars($table) . '<br>';
                                    }
                                } else {
                                    echo '(ÌÖåÏù¥Î∏î(Îì§)Ïù¥ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÍ±∞ÎÇò, ÏóëÏÑ∏Ïä§Ìï† Í∂åÌïúÏù¥ Î∂ÄÏó¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§)';
                                }
                                echo '</div>';
                                
                                sqlsrv_free_stmt($tables_stmt);
                            }
                            
                            // Í∞ÑÎã®Ìïú ÏøºÎ¶¨ ÌÖåÏä§Ìä∏
                            echo '<h4 style="margin-top: 20px;">üß™ ÏøºÎ¶¨ ÌÖåÏä§Ìä∏</h4>';
                            
                            $test_query = "SELECT 1 as test_value, 'Hello MyShop!' as test_message";
                            $test_stmt = sqlsrv_query($conn, $test_query);
                            
                            if ($test_stmt) {
                                $test_result = sqlsrv_fetch_array($test_stmt, SQLSRV_FETCH_ASSOC);
                                echo '<div class="alert success">';
                                echo '‚úì SELECT ÏøºÎ¶¨ Ïã§Ìñâ ÏÑ±Í≥µ<br>';
                                echo 'Í≤∞Í≥º: ' . htmlspecialchars($test_result['test_message']);
                                echo '</div>';
                                sqlsrv_free_stmt($test_stmt);
                            }
                            
                            // Ïó∞Í≤∞ Ï¢ÖÎ£å
                            sqlsrv_close($conn);
                        }
                    }
                    
                    $end_time = microtime(true);
                    $execution_time = round(($end_time - $start_time) * 1000, 2);
                    ?>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; text-align: center; color: #666; font-size: 13px;">
                        ‚è±Ô∏è ÌÖåÏä§Ìä∏ Ïã§Ìñâ ÏãúÍ∞Ñ: <?php echo $execution_time; ?>ms
                    </div>
                </div>
            </div>

            <!-- Í∂åÏû• ÏÇ¨Ìï≠ -->
            <?php if ($connection_success): ?>
            <div class="test-section">
                <div class="test-header">
                    <span>‚úÖ Îã§Ïùå Îã®Í≥Ñ</span>
                </div>
                <div class="test-body">
                    <div class="alert success">
                        <strong>Ïó∞Í≤∞Ïù¥ Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÏûëÎèôÌï©ÎãàÎã§!</strong><br><br>
                        Ïù¥Ï†ú Îã§Ïùå ÏûëÏóÖÏùÑ ÏßÑÌñâÌï† Ïàò ÏûàÏäµÎãàÎã§:
                    </div>
                    <ul>
                        <li>MyShop Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÌéòÏù¥ÏßÄ Ï†ëÏÜç</li>
                        <li>Î°úÍ∑∏Ïù∏ Î∞è Í∏∞Îä• ÌÖåÏä§Ìä∏</li>
                        <li><strong style="color: red;">Î≥¥Ïïà: Ïù¥ ÌÖåÏä§Ìä∏ ÌååÏùºÏùÑ ÏÇ≠Ï†úÌïòÍ±∞ÎÇò Ï†ëÍ∑º Ï†úÌïú</strong></li>
                    </ul>
                </div>
            </div>
            <?php endif; ?>
            
            <div style="text-align: center; margin-top: 30px;">
                <a href="javascript:location.reload()" class="button">üîÑ Îã§Ïãú ÌÖåÏä§Ìä∏</a>
                <?php if ($connection_success): ?>
                    <a href="index.php" class="button" style="margin-left: 10px; background: #28a745;">üè† Î©îÏù∏ÏúºÎ°ú</a>
                <?php endif; ?>
            </div>
        </div>
        
        <div class="footer-note">
            <strong>‚ö†Ô∏è Î≥¥Ïïà Í≤ΩÍ≥†</strong><br>
            Ïù¥ ÌååÏùºÏùÄ ÌÖåÏä§Ìä∏ Ïö©ÎèÑÎ°úÎßå ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî. ÌÖåÏä§Ìä∏ ÏôÑÎ£å ÌõÑ Î∞òÎìúÏãú ÏÇ≠Ï†úÌïòÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.<br>
            ÎØºÍ∞êÌïú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï†ïÎ≥¥Í∞Ä ÎÖ∏Ï∂úÎê† Ïàò ÏûàÏäµÎãàÎã§.
        </div>
    </div>
</body>
</html>